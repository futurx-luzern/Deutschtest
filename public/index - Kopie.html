<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Einstufungstest Deutsch (Vollständig & Verbessert)</title>
    <link rel="stylesheet" href="css/tailwind.min.css">
    <style>
        :root { --base-font-size: 1rem; }
        body { font-size: var(--base-font-size); font-family: ui-sans-serif, system-ui, sans-serif; }
        input.gap-input { all: unset; display: inline-block !important; vertical-align: baseline !important; box-sizing: content-box !important; width: auto !important; min-width: 3ch !important; border-bottom: 1px dotted #9ca3af !important; background: none !important; background-color: transparent !important; margin: 0 !important; padding: 0 !important; box-shadow: none !important; outline: none !important; appearance: none !important; -webkit-appearance: none !important; -moz-appearance: none !important; font: inherit !important; color: inherit !important; line-height: inherit !important; transition: min-width 0.2s; white-space: nowrap; }
        input.gap-input:focus { outline: none !important; border-bottom: 1px solid #6b7280 !important; }
        .text-answer-input { border: 1px solid #d1d5db; padding: 0.5rem 0.75rem; border-radius: 0.375rem; width: 100%; margin-top: 0.5rem; }
        .test-section { display: none; opacity: 0; transition: opacity 0.4s ease-in-out; }
        .test-section.active { display: block; opacity: 1; }
        .required-indicator::after { content: '*'; color: #dc2626; margin-left: 0.25rem; }
        .question-container { margin-bottom: 1.75rem; padding: 1.25rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; background-color: #f9fafb; }
        .mc-option { display: block; margin-bottom: 0.6rem; cursor: pointer; padding: 0.35rem 0; }
        .mc-option label { cursor: pointer; display: inline-block; }
        .mc-option input[type="radio"], .mc-option input[type="checkbox"] { margin-right: 0.75rem; accent-color: #4f46e5; width: 1.1em; height: 1.1em; vertical-align: middle; cursor: pointer; }
        input:not(.gap-input):focus, select:focus, textarea:focus { outline: 2px solid #818cf8; outline-offset: 1px; border-color: transparent; box-shadow: 0 0 0 2px #c7d2fe; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #e5e7eb; padding: 0.5rem 0.75rem; vertical-align: middle; }
        th { background-color: #f3f4f6; text-align: left; }
        td input[type="radio"], td input[type="checkbox"] { margin: 0 auto; display: block; }
        #pause-overlay { transition: opacity 0.3s ease-in-out; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        #start-test-btn:disabled { background-color: #9ca3af; }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8 font-sans">
    <div class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-xl shadow-lg relative">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4 border-b pb-3">Einstufungstest Deutsch</h1>
        <div class="mb-4">
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                <div id="progress-bar" class="bg-indigo-500 h-2.5 rounded-full transition-all duration-300 ease-out" style="width: 0%"></div>
            </div>
            <div class="flex items-center justify-end gap-2 text-sm">
                <span class="font-medium text-gray-600">Schriftgrösse:</span>
                <button id="decrease-font-btn" title="Schrift verkleinern" class="px-2 py-0.5 rounded-md bg-gray-100 hover:bg-gray-200 border border-gray-300 text-gray-700 transition duration-150 ease-in-out">-</button>
                <button id="increase-font-btn" title="Schrift vergrössern" class="px-2 py-0.5 rounded-md bg-gray-100 hover:bg-gray-200 border border-gray-300 text-gray-700 transition duration-150 ease-in-out">+</button>
            </div>
        </div>
        <div class="flex justify-between items-center mb-6 text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
            <div id="progress-indicator" class="font-medium">Startseite</div>
        </div>

        <div id="test-container">
            <section id="section-0" class="test-section active">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Willkommen!</h2>
                <p class="mb-4 text-gray-600">Dieser Test erfasst Ihre grundlegenden Kenntnisse in Deutsch.</p>
                <p class="mb-4 text-gray-600">Bitte beantworten Sie die Fragen sorgfältig. Ihr Fortschritt wird automatisch im gewählten Ordner gesichert, wenn Sie den Test bearbeiten.</p>
                <div class="mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                    <button id="select-dir-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition duration-150 ease-in-out mb-2">
                        Sicherungsordner wählen...
                    </button>
                    <div>
                        <p id="dir-status" class="text-sm text-gray-600 italic inline-block">Noch kein Ordner ausgewählt.</p>
                        <span id="dir-check" class="text-green-600 ml-2 hidden font-bold text-lg inline-block">&#x2714;</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">
                        (Hinweis für Lehrperson: Bitte den Ordner 'Testergebnisse Deutsch' auf dem USB-Stick auswählen.)
                    </p>
                </div>
                <div class="flex flex-wrap items-end gap-4 mb-6">
                    <div class="w-full md:max-w-md flex-grow">
                        <label for="student-name" class="block mb-1 font-medium text-gray-700 required-indicator">Ihr Name:</label>
                        <input type="text" id="student-name" name="student-name" class="border border-gray-300 p-2 rounded-lg w-full" required>
                        <p id="name-error" class="text-red-600 text-sm mt-1" style="display: none;">Bitte geben Sie Ihren Namen ein.</p>
                    </div>
                    <div class="w-full md:w-auto flex-shrink-0 mt-6 md:mt-0">
                        <button id="start-test-btn" class="bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 text-white font-semibold py-3 px-6 md:py-4 md:px-8 rounded-lg shadow-sm transition duration-150 ease-in-out text-lg w-full md:w-auto disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400" disabled>
                            Test starten
                        </button>
                    </div>
                </div>
            </section>

            <section id="section-1" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil A: Sprache im Fokus</h2>
                <p class="mb-6 text-gray-700">Ergänze in den folgenden Texten jeweils die fehlenden Wortteile sinnvoll. Tipp: Mit der Tabulatortaste springen Sie zum nächsten Feld.</p>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Text 1: Smartphones</h3>
                    <p class="text-gray-700 leading-relaxed">
                        Das Smartphone ist aus dem Alltag vieler junger Schweizerinnen und Schweizer nicht mehr wegzudenken.
                        Sie <span>nutz<input type="text" id="A-01-1" name="A-01-1" class="gap-input" size="3" required spellcheck="false"></span> es
                        <span>stän<input type="text" id="A-01-2" name="A-01-2" class="gap-input" size="3" required spellcheck="false"></span>, um mit
                        <span>Freun<input type="text" id="A-01-3" name="A-01-3" class="gap-input" size="3" required spellcheck="false"></span> zu
                        <span>kommuniz<input type="text" id="A-01-4" name="A-01-4" class="gap-input" size="3" required spellcheck="false"></span>, sich
                        <span>üb<input type="text" id="A-01-5" name="A-01-5" class="gap-input" size="3" required spellcheck="false"></span> aktuelle
                        <span>Ereig<input type="text" id="A-01-6" name="A-01-6" class="gap-input" size="3" required spellcheck="false"></span> zu
                        <span>inform<input type="text" id="A-01-7" name="A-01-7" class="gap-input" size="3" required spellcheck="false"></span> oder
                        <span>einfa<input type="text" id="A-01-8" name="A-01-8" class="gap-input" size="3" required spellcheck="false"></span> nur zur
                        <span>Unterhal<input type="text" id="A-01-9" name="A-01-9" class="gap-input" size="3" required spellcheck="false"></span>.
                        Viele <span>sag<input type="text" id="A-01-10" name="A-01-10" class="gap-input" size="3" required spellcheck="false"></span>,
                        dass <span>s<input type="text" id="A-01-11" name="A-01-11" class="gap-input" size="3" required spellcheck="false"></span> ohne
                        <span>i<input type="text" id="A-01-12" name="A-01-12" class="gap-input" size="3" required spellcheck="false"></span> Handy
                        <span>aufgeschm<input type="text" id="A-01-13" name="A-01-13" class="gap-input" size="3" required spellcheck="false"></span> wären,
                        <span>wei<input type="text" id="A-01-14" name="A-01-14" class="gap-input" size="3" required spellcheck="false"></span> es ihnen hilft,
                        <span>i<input type="text" id="A-01-15" name="A-01-15" class="gap-input" size="3" required spellcheck="false"></span> soziales
                        <span>Le<input type="text" id="A-01-16" name="A-01-16" class="gap-input" size="3" required spellcheck="false"></span> zu
                        <span>organis<input type="text" id="A-01-17" name="A-01-17" class="gap-input" size="3" required spellcheck="false"></span>.
                        Gestern <span>ha<input type="text" id="A-01-18" name="A-01-18" class="gap-input" size="3" required spellcheck="false"></span> ich zum
                        <span>Beisp<input type="text" id="A-01-19" name="A-01-19" class="gap-input" size="3" required spellcheck="false"></span> eine
                        <span>wicht<input type="text" id="A-01-20" name="A-01-20" class="gap-input" size="3" required spellcheck="false"></span> Nachricht
                        <span>üb<input type="text" id="A-01-21" name="A-01-21" class="gap-input" size="3" required spellcheck="false"></span> WhatsApp
                        <span>erhal<input type="text" id="A-01-22" name="A-01-22" class="gap-input" size="3" required spellcheck="false"></span>, die mein
                        <span>ganz<input type="text" id="A-01-23" name="A-01-23" class="gap-input" size="3" required spellcheck="false"></span>
                        <span>Tagesp<input type="text" id="A-01-24" name="A-01-24" class="gap-input" size="3" required spellcheck="false"></span>
                        geändert <span>ha<input type="text" id="A-01-25" name="A-01-25" class="gap-input" size="3" required spellcheck="false"></span>.
                        Es ist <span>jed<input type="text" id="A-01-26" name="A-01-26" class="gap-input" size="3" required spellcheck="false"></span> wichtig,
                        <span>ei<input type="text" id="A-01-27" name="A-01-27" class="gap-input" size="3" required spellcheck="false"></span> gesunde
                        <span>Bala<input type="text" id="A-01-28" name="A-01-28" class="gap-input" size="3" required spellcheck="false"></span> zu
                        <span>find<input type="text" id="A-01-29" name="A-01-29" class="gap-input" size="3" required spellcheck="false"></span> und nicht
                        <span>stän<input type="text" id="A-01-30" name="A-01-30" class="gap-input" size="3" required spellcheck="false"></span>
                        online <span>z<input type="text" id="A-01-31" name="A-01-31" class="gap-input" size="3" required spellcheck="false"></span> sein,
                        um <span>Überfor<input type="text" id="A-01-32" name="A-01-32" class="gap-input" size="3" required spellcheck="false"></span>
                        und <span>Ablen<input type="text" id="A-01-33" name="A-01-33" class="gap-input" size="3" required spellcheck="false"></span>
                        <span>vorzubeu<input type="text" id="A-01-34" name="A-01-34" class="gap-input" size="3" required spellcheck="false"></span>.
                    </p>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Text 2: Zukunftsperspektiven nach der Lehre</h3>
                    <p class="text-gray-700 leading-relaxed">
                        Nach Abschluss einer Berufslehre stellen sich viele junge Erwachsene die Frage nach ihrer beruflichen Zukunft.
                        Einige <span>pla<input type="text" id="A-02-1" name="A-02-1" class="gap-input" size="3" required spellcheck="false"></span> direkt
                        <span>i<input type="text" id="A-02-2" name="A-02-2" class="gap-input" size="3" required spellcheck="false"></span> Berufsleben
                        <span>einzuste<input type="text" id="A-02-3" name="A-02-3" class="gap-input" size="3" required spellcheck="false"></span>, während
                        <span>ande<input type="text" id="A-02-4" name="A-02-4" class="gap-input" size="3" required spellcheck="false"></span> über
                        <span>weiterfüh<input type="text" id="A-02-5" name="A-02-5" class="gap-input" size="3" required spellcheck="false"></span>
                        Ausbildungen <span>nachden<input type="text" id="A-02-6" name="A-02-6" class="gap-input" size="3" required spellcheck="false"></span>.
                        Wenn ich <span>genü<input type="text" id="A-02-7" name="A-02-7" class="gap-input" size="3" required spellcheck="false"></span> Geld
                        <span>gesp<input type="text" id="A-02-8" name="A-02-8" class="gap-input" size="3" required spellcheck="false"></span> hätte,
                        <span>würd<input type="text" id="A-02-9" name="A-02-9" class="gap-input" size="3" required spellcheck="false"></span> ich
                        <span>erst<input type="text" id="A-02-10" name="A-02-10" class="gap-input" size="3" required spellcheck="false"></span> eine
                        <span>läng<input type="text" id="A-02-11" name="A-02-11" class="gap-input" size="3" required spellcheck="false"></span> Reise
                        <span>mach<input type="text" id="A-02-12" name="A-02-12" class="gap-input" size="3" required spellcheck="false"></span>, um
                        <span>ande<input type="text" id="A-02-13" name="A-02-13" class="gap-input" size="3" required spellcheck="false"></span> Kulturen
                        <span>kennenzuler<input type="text" id="A-02-14" name="A-02-14" class="gap-input" size="3" required spellcheck="false"></span>.
                        Viele <span>hoff<input type="text" id="A-02-15" name="A-02-15" class="gap-input" size="3" required spellcheck="false"></span>,
                        dass <span>s<input type="text" id="A-02-16" name="A-02-16" class="gap-input" size="3" required spellcheck="false"></span> einen
                        <span>Jo<input type="text" id="A-02-17" name="A-02-17" class="gap-input" size="3" required spellcheck="false"></span> finden
                        <span>wer<input type="text" id="A-02-18" name="A-02-18" class="gap-input" size="3" required spellcheck="false"></span>, der
                        <span>ihn<input type="text" id="A-02-19" name="A-02-19" class="gap-input" size="3" required spellcheck="false"></span> nicht
                        <span>n<input type="text" id="A-02-20" name="A-02-20" class="gap-input" size="3" required spellcheck="false"></span> finanzielle
                        <span>Sicher<input type="text" id="A-02-21" name="A-02-21" class="gap-input" size="3" required spellcheck="false"></span> bietet,
                        <span>sond<input type="text" id="A-02-22" name="A-02-22" class="gap-input" size="3" required spellcheck="false"></span> auch
                        <span>persön<input type="text" id="A-02-23" name="A-02-23" class="gap-input" size="3" required spellcheck="false"></span>
                        <span>Erfüll<input type="text" id="A-02-24" name="A-02-24" class="gap-input" size="3" required spellcheck="false"></span>.
                        Die <span>Entschei<input type="text" id="A-02-25" name="A-02-25" class="gap-input" size="3" required spellcheck="false"></span> über
                        <span>d<input type="text" id="A-02-26" name="A-02-26" class="gap-input" size="3" required spellcheck="false"></span> nächsten
                        <span>Schri<input type="text" id="A-02-27" name="A-02-27" class="gap-input" size="3" required spellcheck="false"></span> ist
                        <span>nic<input type="text" id="A-02-28" name="A-02-28" class="gap-input" size="3" required spellcheck="false"></span> immer
                        <span>einfa<input type="text" id="A-02-29" name="A-02-29" class="gap-input" size="3" required spellcheck="false"></span>, aber
                        <span>s<input type="text" id="A-02-30" name="A-02-30" class="gap-input" size="3" required spellcheck="false"></span> wird
                        <span>d<input type="text" id="A-02-31" name="A-02-31" class="gap-input" size="3" required spellcheck="false"></span> weiteren
                        <span>Lebens<input type="text" id="A-02-32" name="A-02-32" class="gap-input" size="3" required spellcheck="false"></span> massgeblich
                        <span>präg<input type="text" id="A-02-33" name="A-02-33" class="gap-input" size="3" required spellcheck="false"></span>.
                        Eine <span>sorgfäl<input type="text" id="A-02-34" name="A-02-34" class="gap-input" size="3" required spellcheck="false"></span>
                        Planung <span>k<input type="text" id="A-02-35" name="A-02-35" class="gap-input" size="3" required spellcheck="false"></span>
                        dabei <span>helf<input type="text" id="A-02-36" name="A-02-36" class="gap-input" size="3" required spellcheck="false"></span>, die
                        <span>rich<input type="text" id="A-02-37" name="A-02-37" class="gap-input" size="3" required spellcheck="false"></span> Weichen
                        <span>z<input type="text" id="A-02-38" name="A-02-38" class="gap-input" size="3" required spellcheck="false"></span> stellen.
                    </p>
                </div>
            </section>

            <section id="section-2" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil B: Orthografie – Block 1</h2>
                <p class="mb-6 text-gray-700">Wähle bei jeder Aufgabe die korrekte Antwort aus bzw. die korrekte Schreibweise/Zeichensetzung.</p>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Gross-/Kleinschreibung</h3>
                    <p class="text-gray-700 mb-2">Was ist richtig geschrieben?</p>
                    <label class="mc-option"><input type="radio" name="B-01-1" value="a"> Beim Lernen braucht man Ruhe.</label>
                    <label class="mc-option"><input type="radio" name="B-01-1" value="b"> Beim lernen braucht man Ruhe.</label>
                    <label class="mc-option"><input type="radio" name="B-01-1" value="c"> Beim Lernen braucht man ruhe.</label>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Getrennt-/Zusammenschreibung</h3>
                    <p class="text-gray-700 mb-2">Was ist richtig geschrieben? Sie will am Wettbewerb _____.</p>
                    <label class="mc-option"><input type="radio" name="B-01-2" value="a"> teil nehmen</label>
                    <label class="mc-option"><input type="radio" name="B-01-2" value="b"> teilnehmen</label>
                    <label class="mc-option"><input type="radio" name="B-01-2" value="c"> Teil nehmen</label>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Korrekte Verbform</h3>
                    <p class="text-gray-700 mb-2">Wähle die korrekte Form. Er __________ gestern den Vertrag.</p>
                    <label class="mc-option"><input type="radio" name="B-01-3" value="a"> unterschrib</label>
                    <label class="mc-option"><input type="radio" name="B-01-3" value="b"> unterschrieb</label>
                    <label class="mc-option"><input type="radio" name="B-01-3" value="c"> unterschreibte</label>
                </div>
            </section>

            <section id="section-3" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil B: Orthografie – Block 2</h2>
                <p class="mb-6 text-gray-700">Wähle bei jeder Aufgabe die korrekte Antwort aus bzw. die korrekte Schreibweise/Zeichensetzung.</p>
                <div class="question-container">
                    <p class="text-gray-700 mb-2">Welcher Satz ist korrekt kommatiert?</p> <label class="mc-option"><input type="radio" name="B-02-1" value="a"> Ich gehe jetzt nach Hause, weil ich müde bin.</label>
                    <label class="mc-option"><input type="radio" name="B-02-1" value="b"> Ich gehe jetzt nach Hause weil ich müde bin.</label>
                    <label class="mc-option"><input type="radio" name="B-02-1" value="c"> Ich gehe jetzt, nach Hause weil ich müde bin.</label>
                </div>
                <div class="question-container">
                    <p class="text-gray-700 mb-2">Welcher Satz ist korrekt kommatiert?</p> <label class="mc-option"><input type="radio" name="B-02-2" value="a"> Das Velo das ich gekauft habe war teuer.</label>
                    <label class="mc-option"><input type="radio" name="B-02-2" value="b"> Das Velo, das ich gekauft habe, war teuer.</label>
                    <label class="mc-option"><input type="radio" name="B-02-2" value="c"> Das Velo das ich gekauft habe, war teuer.</label>
                </div>
                <div class="question-container">
                    <p class="text-gray-700 mb-2">Welcher Satz ist korrekt kommatiert?</p> <label class="mc-option"><input type="radio" name="B-02-3" value="a"> Er versucht, den Ball mit einer schnellen Bewegung zu fangen.</label>
                    <label class="mc-option"><input type="radio" name="B-02-3" value="b"> Er versucht den Ball mit einer schnellen Bewegung zu fangen.</label>
                    <label class="mc-option"><input type="radio" name="B-02-3" value="c"> Er versucht den Ball, mit einer schnellen Bewegung zu fangen.</label>
                </div>
            </section>

            <section id="section-4" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil B: Orthografie – Block 3</h2>
                <p class="mb-6 text-gray-700">Wähle bei jeder Aufgabe die korrekte Antwort aus bzw. die korrekte Schreibweise/Zeichensetzung.</p>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Passiv (Präteritum)</h3>
                    <p class="text-gray-700 mb-2">Wähle die korrekte Form. Das Fenster __________ gestern geschlossen.</p>
                    <label class="mc-option"><input type="radio" name="B-03-1" value="a"> wurde</label>
                    <label class="mc-option"><input type="radio" name="B-03-1" value="b"> worden</label>
                    <label class="mc-option"><input type="radio" name="B-03-1" value="c"> ist</label>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Konjunktiv I (indirekte Rede)</h3>
                    <p class="text-gray-700 mb-2">Wähle die korrekte Form. Die Sprecherin erklärte, sie __________ krank gewesen.</p>
                    <label class="mc-option"><input type="radio" name="B-03-2" value="a"> sei</label>
                    <label class="mc-option"><input type="radio" name="B-03-2" value="b"> wäre</label>
                    <label class="mc-option"><input type="radio" name="B-03-2" value="c"> war</label>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Konjunktiv II (Bedingung)</h3>
                    <p class="text-gray-700 mb-2">Wähle die korrekte Form. Wenn ich Zeit hätte, __________ ich dich besuchen.</p>
                    <label class="mc-option"><input type="radio" name="B-03-3" value="a"> würde</label>
                    <label class="mc-option"><input type="radio" name="B-03-3" value="b"> werde</label>
                    <label class="mc-option"><input type="radio" name="B-03-3" value="c"> wäre</label>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Relativpronomen (Kasus)</h3>
                    <p class="text-gray-700 mb-2">Wähle das korrekte Relativpronomen. Kennst du den Film, __________ gestern im Kino lief?</p>
                    <label class="mc-option"><input type="radio" name="B-03-4" value="a"> der</label>
                    <label class="mc-option"><input type="radio" name="B-03-4" value="b"> den</label>
                    <label class="mc-option"><input type="radio" name="B-03-4" value="c"> dem</label>
                </div>
            </section>

            <section id="section-5" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil B: Orthografie – Block 4</h2>
                <p class="mb-6 text-gray-700">Wähle bei jeder Aufgabe die korrekte Antwort aus bzw. die korrekte Schreibweise/Zeichensetzung.</p>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Kasus nach Präposition</h3>
                    <p class="text-gray-700 mb-2">Wähle die korrekte Form. Trotz __________ Nebels fuhren sie los.</p>
                    <label class="mc-option"><input type="radio" name="B-04-1" value="a"> des starken</label>
                    <label class="mc-option"><input type="radio" name="B-04-1" value="b"> dem starken</label>
                    <label class="mc-option"><input type="radio" name="B-04-1" value="c"> den starken</label>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Präziser Ausdruck</h3>
                    <p class="text-gray-700 mb-2">
                        Welches Wort passt am besten in einem offiziellen Bericht? „Die Kommission wird den Antrag ________, bevor sie entscheidet.“
                    </p>
                    <label class="mc-option"><input type="radio" name="B-04-2" value="a"> anschauen</label>
                    <label class="mc-option"><input type="radio" name="B-04-2" value="b"> prüfen</label>
                    <label class="mc-option"><input type="radio" name="B-04-2" value="c"> anchecken</label>
                </div>
            </section>

            <section id="section-6" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil C: Lesen – Aufgabe 1</h2>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-3 text-gray-800">Kursangebot «Alles Bio»</h3>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        Unsere Tageskurse ermöglichen Schulklassen den Einblick in ein Stück unbekannte Schweiz und garantieren einen erlebnisreichen Tag auf unserem Biohof, an dem geforscht, beobachtet und aktiv hinterfragt werden kann. Unser Animationsteam und die Hoffamilie begleiten die Jugendlichen und helfen bei Fragen und Unklarheiten.
                    </p>
                    <p class="text-gray-700 font-semibold mt-6 mb-2">Programme für Schulklassen:</p>
                    <ul class="list-disc list-inside text-gray-700 ml-4 space-y-4">
                        <li><strong>bioparcours:</strong> Den bioparcours mittels Fragestellungen und Aufgaben erkunden. Geeignet für Jugendliche zwischen 14 und 18 Jahren aller Schulstufen. Die Aufgaben können dem Leistungsniveau der Klasse angepasst werden.</li>
                        <li><strong>biomarketing:</strong> Als Agentur einen Tag lang Werbung für Bio machen. Ideal für junge Erwachsene ab 16 Jahren aus der Gymnasialstufe oder aus Handelsschulen mit Betriebswirtschaftsunterricht.</li>
                        <li><strong>cook-together:</strong> 3–4 Jugendliche aus der Klasse kochen unter Anleitung eines Profikochs mit Produkten direkt ab Hof, betreuen Degustationen und erarbeiten Beiträge rund um das Thema Lebensmittel.</li>
                    </ul>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Aufgabe</h3>
                    <p class="text-gray-700 mb-4">Beurteile die folgenden Aussagen. Wähle jeweils: <strong>Richtig / Falsch / Unklar</strong></p>
                    <table class="w-full text-sm text-left text-gray-700">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                            <tr>
                                <th scope="col" class="py-2 px-3">Aussage</th>
                                <th scope="col" class="py-2 px-3 text-center w-16">Richtig</th>
                                <th scope="col" class="py-2 px-3 text-center w-16">Falsch</th>
                                <th scope="col" class="py-2 px-3 text-center w-16">Unklar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b"> <td class="py-2 px-3">1. Alle Kurse dauern einen Tag.</td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-1" value="Richtig"></td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-1" value="Falsch"></td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-1" value="Unklar"></td>
                            </tr>
                            <tr class="border-b"> <td class="py-2 px-3">2. Die Kurse werden von einer Werbeagentur veranstaltet.</td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-2" value="Richtig"></td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-2" value="Falsch"></td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-2" value="Unklar"></td>
                            </tr>
                            <tr class="border-b"> <td class="py-2 px-3">3. Das Kursangebot ist kostenlos.</td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-3" value="Richtig"></td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-3" value="Falsch"></td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-3" value="Unklar"></td>
                            </tr>
                            <tr> <td class="py-2 px-3">4. Die Kurse sind Teil eines Ferienangebots.</td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-4" value="Richtig"></td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-4" value="Falsch"></td>
                                <td class="py-2 px-3 text-center"><input type="radio" name="lesen_biohof_01-4" value="Unklar"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="section-7" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil C: Lesen – Aufgabe 2</h2>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-6 text-gray-800">Tempo 130 auf Schweizer Autobahnen? – Meinungen</h3>
                    <div class="mb-4 p-3 border rounded bg-gray-50">
                        <p class="font-medium text-gray-800">Paula:</p>
                        <p class="text-gray-700 leading-relaxed mt-1">Der heutige Berufsverkehr bringt mich manchmal an die Grenzen meiner Selbstbeherrschung. Da schleichen die Leute teilweise mit 110 km/h auf der Überholspur und man kommt wegen des Tempolimits kaum dazu, zügig zu überholen. Das ist schlicht gefährlich. Eine Erhöhung des Tempolimits um 10 km/h würde auf Autobahnen für einen besseren Verkehrsfluss sorgen.</p>
                    </div>
                    <div class="mb-4 p-3 border rounded bg-gray-50">
                        <p class="font-medium text-gray-800">Max:</p>
                        <p class="text-gray-700 leading-relaxed mt-1">Mein Porsche braucht Auslauf. Und damit meine ich nicht ein Schneckentempo von 120 km/h. Moderne Fahrzeuge sind bei Tempo 200 noch genauso sicher wie Fahrzeuge vor zehn Jahren bei Tempo 100. Das Tempolimit ist aus technologischer Sicht einfach nicht mehr zeitgemäss. Aber der Verkehr in der Schweiz lässt es nicht zu, dass wir auf unseren Autobahnen schneller fahren. Von daher finde ich das geltende Tempolimit sinnvoll. Deshalb fahre ich ab und zu nach Deutschland und gebe dort Vollgas.</p>
                    </div>
                    <div class="p-3 border rounded bg-gray-50">
                        <p class="font-medium text-gray-800">Claudia:</p>
                        <p class="text-gray-700 leading-relaxed mt-1">Ich verstehe nicht, warum es die Leute so eilig haben. Ich fahre selten schneller als 80 km/h, auch auf Autobahnen. Bisher bin ich immer pünktlich ans Ziel gekommen. Diese Raserei ist rücksichtslos und gefährlich. Der Gesetzgeber darf das nicht noch unterstützen, indem er das Tempolimit auf Autobahnen erhöht. Dann wird noch mehr gerast.</p>
                    </div>
                </div>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-3 text-gray-800">Aufgabe</h3>
                    <p class="text-gray-700 mb-4">Ordne die folgenden Aussagen den Personen Paula, Max oder Claudia zu. Setze bei jeder Aussage die Kreuze bei den zutreffenden Personen.</p>
                    <table class="w-full text-sm text-left text-gray-700">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                            <tr>
                                <th scope="col" class="py-2 px-3">Aussage</th>
                                <th scope="col" class="py-2 px-3 text-center w-16">Paula</th>
                                <th scope="col" class="py-2 px-3 text-center w-16">Max</th>
                                <th scope="col" class="py-2 px-3 text-center w-16">Claudia</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b">
                                <td class="py-2 px-3">1. Möchte auf der Schweizer Autobahn schneller fahren</td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Paula[]" value="1"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Max[]" value="1"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Claudia[]" value="1"></td>
                            </tr>
                            <tr class="border-b">
                                <td class="py-2 px-3">2. Ist der Meinung, dass das Tempolimit dem Verkehrsaufkommen angepasst sein muss</td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Paula[]" value="2"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Max[]" value="2"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Claudia[]" value="2"></td>
                            </tr>
                            <tr class="border-b">
                                <td class="py-2 px-3">3. Ist der Meinung, dass heute schon viel zu schnell gefahren wird</td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Paula[]" value="3"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Max[]" value="3"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Claudia[]" value="3"></td>
                            </tr>
                            <tr class="border-b">
                                <td class="py-2 px-3">4. Ärgert sich über andere Verkehrsteilnehmer</td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Paula[]" value="4"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Max[]" value="4"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Claudia[]" value="4"></td>
                            </tr>
                            <tr class="border-b">
                                <td class="py-2 px-3">5. Fährt im Ausland schneller als in der Schweiz</td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Paula[]" value="5"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Max[]" value="5"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Claudia[]" value="5"></td>
                            </tr>
                            <tr>
                                <td class="py-2 px-3">6. Ist für eine Erhöhung des Tempolimits auf der Autobahn</td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Paula[]" value="6"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Max[]" value="6"></td>
                                <td class="py-2 px-3 text-center"><input type="checkbox" name="lesen_tempolimit_02-Claudia[]" value="6"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <section id="section-8" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil C: Lesen – Aufgabe 3</h2>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-6 text-gray-800">Kolumbus und der Westweg</h3>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        Im 15. Jahrhundert waren Gewürze und Seide aus Asien in Europa sehr beliebt. Doch die Reise über den Landweg nach Indien war beschwerlich – und sie kostete viel Geld, weil hohe Zölle für die Waren verlangt wurden. Da hatte Kolumbus eine Idee: Es müsse doch auch möglich sein, mit dem Schiff nach Westen zu fahren – immer weiter, bis er schliesslich Indien erreichen würde.
                        <br><br>Damit war er nicht der erste, der von einem Westweg nach Asien ausging: Schon der griechische Philosoph Aristoteles hatte geglaubt, dass dies möglich sei. Kolumbus machte sich daran, seinen Plan umzusetzen. Er berechnete die Entfernung – und dabei passierte ihm ein gewaltiger Fehler: Er verschätzte sich beim Erdumfang und ging davon aus, dass die Reise nach Asien viel kürzer sei. Tatsächlich hatte er sich um ungefähr 10'000 Kilometer verrechnet.
                        <br><br>Nun fehlte nur noch das Geld. Das spanische Königspaar unterstützte sein Vorhaben schliesslich. Sie versprachen sich Macht und Reichtum für ihr Land, sollte Kolumbus wirklich den Seeweg nach Indien finden.
                        <br><br>Am 3. August 1492 stach Kolumbus in See – immer Richtung Westen auf der Suche nach Indien. Nach drei Wochen auf hoher See kamen Angst und Zweifel auf: Weit und breit keine Küste! Am 12. Oktober 1492 erklang endlich der ersehnte Ruf: «Land in Sicht!» Aber Kolumbus landete nicht in Indien. Dass Indien in weiter Ferne lag, ahnte er zu diesem Zeitpunkt nicht – und so nannte er die Bewohner des Landes Indianer. Eigentlich war er in Amerika gelandet. Er ahnte auch nicht, dass er gerade einen neuen Kontinent entdeckt hatte.
                    </p>
                </div>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-3 text-gray-800">Aufgabe</h3>
                    <p class="text-gray-700 mb-4">Markiere <b>zwei</b> Aussagen, die laut Text korrekt sind:</p>
                    <ul>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_kolumbus_03[]" value="1"> Das spanische Königspaar finanzierte seine Entdeckungsfahrt nach Amerika.</label></li>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_kolumbus_03[]" value="2"> Der Grund dafür, dass Kolumbus sein geplantes Ziel nicht erreichte, war die falsche Einschätzung des Erdumfangs.</label></li>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_kolumbus_03[]" value="3"> Kolumbus war nicht der erste Gelehrte, der die Idee hatte, auf dem Westweg nach Indien zu reisen.</label></li>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_kolumbus_03[]" value="4"> Kolumbus finanzierte seine Seereisen mit dem Geld, das er von einem reichen Onkel geerbt hatte.</label></li>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_kolumbus_03[]" value="5"> Die Seereise dauerte drei Wochen.</label></li>
                    </ul>
                </div>
            </section>

            <section id="section-9" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil C: Lesen – Aufgabe 4</h2>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-6 text-gray-800">Sauerstoffproduktion der Bäume</h3>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        Bäume erzeugen Sauerstoff und Traubenzucker aus dem Kohlendioxid in der Luft. Sie benötigen dazu den grünen Blattfarbstoff Chlorophyll, zudem Wasser und Sonnenlicht als Energielieferanten. Auch Kunstlicht kann diesen Vorgang, genannt Fotosynthese, auslösen. Bäume müssen auch «atmen», wobei der gespeicherte Zucker mithilfe von Sauerstoff aus der Luft wieder in Kohlendioxid und Energie umgewandelt wird. Trotzdem produzieren Bäume und Pflanzen bedeutend mehr Sauerstoff, als sie selbst verbrauchen.
                    </p>
                </div>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-3 text-gray-800">Aufgabe</h3>
                    <p class="text-gray-700 mb-4">Wähle <b>zwei</b> Aussagen aus, die laut Text korrekt sind:</p>
                    <ul>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_fotosynthese_04[]" value="1"> Der grüne Blattfarbstoff wird Chlorophyll genannt.</label></li>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_fotosynthese_04[]" value="2"> Bäume und Pflanzen produzieren mehr Kohlendioxid, als sie verbrauchen.</label></li>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_fotosynthese_04[]" value="3"> Zur Fotosynthese brauchen die Bäume Wasser, Sonnenlicht und Chlorophyll.</label></li>
                        <li class="mc-option"><label><input type="checkbox" name="lesen_fotosynthese_04[]" value="4"> Kunstlicht hat keinen Einfluss auf die Fotosynthese.</label></li>
                    </ul>
                </div>
            </section>

            <section id="section-10" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil C: Lesen – Aufgabe 5</h2>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-6 text-gray-800">Vertrauen auf Knopfdruck?</h3>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        Stell dir vor, ein neuer digitaler Assistent hilft dir dabei, deine Entscheidungen im Alltag zu treffen. Du gibst ein, was dich beschäftigt – sei es die Wahl einer Ausbildung, ein Streit mit Freunden oder Unsicherheit über deine Zukunft – und erhältst in Sekundenschnelle eine wohlformulierte Antwort mit Empfehlungen.
                        <br><br>Was nach Science-Fiction klingt, ist heute Realität: Künstliche Intelligenzen geben Ratschläge, interpretieren Emotionen und beeinflussen unser Verhalten. Je nützlicher diese Systeme sind, desto eher neigen Menschen dazu, ihnen zu vertrauen – auch wenn sie gar nicht verstehen, wie sie funktionieren. Doch was heisst es, Maschinen zu vertrauen? Und was passiert, wenn sie sich irren?
                        <br><br>Vertrauen braucht normalerweise Zeit, Erfahrung und das Wissen, dass jemand unsere Interessen berücksichtigt. Doch bei digitalen Systemen ersetzt oft eine einzige erfolgreiche Empfehlung bereits diese langsame Entwicklung. Fachleute warnen deshalb vor einem «Vertrauensvorschuss», der nicht auf echtem Verständnis beruht. Wer sich blind auf Maschinen verlässt, läuft Gefahr, wichtige Entscheidungen aus der Hand zu geben – ohne es zu merken.
                    </p>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-3 text-gray-800">Aufgabe</h3>
                    <p class="text-gray-700 mb-4">Beantworte beide Fragen schriftlich (je 2–3 Sätze):</p>
                    <div class="mb-4">
                        <label for="lesen_vertrauen_05-a" class="block mb-2 font-medium text-gray-700">a) Warum ist Vertrauen in digitale Systeme laut Text problematisch?</label>
                        <textarea id="lesen_vertrauen_05-a" name="lesen_vertrauen_05-a" rows="4" class="text-answer-input" placeholder="Ihre Antwort zu a)..." spellcheck="false"></textarea>
                    </div>
                    <div>
                        <label for="lesen_vertrauen_05-b" class="block mb-2 font-medium text-gray-700">b) Worin liegt laut Text der Unterschied zwischen menschlichem und technischem Vertrauen?</label>
                        <textarea id="lesen_vertrauen_05-b" name="lesen_vertrauen_05-b" rows="4" class="text-answer-input" placeholder="Ihre Antwort zu b)..." spellcheck="false"></textarea>
                    </div>
                </div>
            </section>

            <section id="section-11" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil D: Hören – Teil 1</h2>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">1. Welchen Beruf übt der Mann aus?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 1 - Niveau 1_1.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-01" value="a"> Antiquitätenhändler</label></li> <li class="mc-option"><label><input type="radio" name="D-01" value="b"> Arzt</label></li> <li class="mc-option"><label><input type="radio" name="D-01" value="c"> Lehrer</label></li> <li class="mc-option"><label><input type="radio" name="D-01" value="d"> Rechtsanwalt</label></li> </ul>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">2. Was bedeutet «Station» im gehörten Zusammenhang?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 2 - Niveau 1_2.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-02" value="a"> Einrichtung</label></li> <li class="mc-option"><label><input type="radio" name="D-02" value="b"> Haltestelle</label></li> <li class="mc-option"><label><input type="radio" name="D-02" value="c"> Abteilung</label></li> <li class="mc-option"><label><input type="radio" name="D-02" value="d"> Ort</label></li> </ul>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">3. Welcher Titel passt zur Kurzmeldung?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 3 - Niveau 1_3.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-03" value="a"> Bauer findet Kriegsgranate</label></li> <li class="mc-option"><label><input type="radio" name="D-03" value="b"> Bauer entschärft Bombe</label></li> <li class="mc-option"><label><input type="radio" name="D-03" value="c"> Bombe aus dem zweiten Weltkrieg explodiert</label></li> <li class="mc-option"><label><input type="radio" name="D-03" value="d"> Spezialkräfte der Polizei stehen vor unlösbarem Problem</label></li> </ul>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">4. Beurteile die Aussage des Mannes</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 4 - Niveau 2_1.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-04" value="a"> Der Mann fühlt sich von der Hausarbeit überfordert.</label></li> <li class="mc-option"><label><input type="radio" name="D-04" value="b"> Der Mann findet, dass Frauen den Männern überlegen sind.</label></li> <li class="mc-option"><label><input type="radio" name="D-04" value="c"> Der Mann äussert sich abschätzig über Hausarbeiten und Frauen.</label></li> <li class="mc-option"><label><input type="radio" name="D-04" value="d"> Der Mann findet, dass Frauen den Männern ebenbürtig sind.</label></li> </ul>
                </div>
            </section>

            <section id="section-12" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil D: Hören – Teil 2</h2>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">5. Was bedeutet «Stift» im gehörten Zusammenhang?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 5 - Niveau 2_2.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-05" value="a"> Verbindungsstück</label></li> <li class="mc-option"><label><input type="radio" name="D-05" value="b"> Spende</label></li> <li class="mc-option"><label><input type="radio" name="D-05" value="c"> Lernender</label></li> <li class="mc-option"><label><input type="radio" name="D-05" value="d"> Schreibgerät</label></li> </ul>
                </div>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-2 text-gray-800">6. Beurteile die Aussagen der Schauspielerin (Richtig/Falsch)</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 6 - Niveau 2_3.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <table class="w-full text-sm text-left text-gray-700">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100"> <tr> <th scope="col" class="py-2 px-3">Aussage</th> <th scope="col" class="py-2 px-3 text-center w-16">Richtig</th> <th scope="col" class="py-2 px-3 text-center w-16">Falsch</th> </tr> </thead>
                        <tbody>
                            <tr class="border-b"> <td class="py-2 px-3">Auf einer Reise wäre sie einmal beinahe ermordet worden.</td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-1" value="R"></td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-1" value="F"></td> </tr>
                            <tr class="border-b"> <td class="py-2 px-3">Sie zieht ein Ferienhaus einem Hotel vor.</td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-2" value="R"></td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-2" value="F"></td> </tr>
                            <tr class="border-b"> <td class="py-2 px-3">In jungen Jahren ist sie einmal durch die Schweiz getrampt.</td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-3" value="R"></td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-3" value="F"></td> </tr>
                            <tr class="border-b"> <td class="py-2 px-3">Sie reist sehr gerne.</td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-4" value="R"></td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-4" value="F"></td> </tr>
                            <tr> <td class="py-2 px-3">In fremden Städten besucht sie gerne Museen.</td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-5" value="R"></td> <td class="py-2 px-3 text-center"><input type="radio" name="D-06-5" value="F"></td> </tr>
                        </tbody>
                    </table>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">7. Welchem Fachbereich lässt sich der Begriff «Grad» im gehörten Zusammenhang zuordnen?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 7 - Niveau 3_1.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-07" value="a"> Biologie</label></li> <li class="mc-option"><label><input type="radio" name="D-07" value="b"> Physik</label></li> <li class="mc-option"><label><input type="radio" name="D-07" value="c"> Geografie</label></li> <li class="mc-option"><label><input type="radio" name="D-07" value="d"> Geometrie</label></li> </ul>
                </div>
                <div class="question-container"> <h3 class="font-semibold text-lg mb-2 text-gray-800">8. Welches Wort in den folgenden Aussagen ist ironisch gemeint?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 8 - Niveau 3_2.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <p class="text-gray-700"> Antwort: <input type="text" id="D-08" name="D-08" class="border border-gray-300 p-1 rounded ml-2"> </p>
                </div>
            </section>

            <section id="section-13" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil D: Hören – Teil 3</h2>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">9. Larissa ist in der 2. Sekundarklasse ... Welches Verb beschreibt das Gesprächsverhalten ihrer Mutter am besten?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 9 - Niveau 3_3.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-09" value="a"> drohen</label></li> <li class="mc-option"><label><input type="radio" name="D-09" value="b"> erpressen</label></li> <li class="mc-option"><label><input type="radio" name="D-09" value="c"> einschüchtern</label></li> <li class="mc-option"><label><input type="radio" name="D-09" value="d"> beraten</label></li> <li class="mc-option"><label><input type="radio" name="D-09" value="e"> sich aufdrängen</label></li> </ul>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">10. Was bedeutet «plastisch» im gehörten Zusammenhang?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 10 - Niveau 4_1.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-10" value="a"> Anschaulich</label></li> <li class="mc-option"><label><input type="radio" name="D-10" value="b"> Künstlerisch</label></li> <li class="mc-option"><label><input type="radio" name="D-10" value="c"> Aus Kunststoff</label></li> <li class="mc-option"><label><input type="radio" name="D-10" value="d"> Körperlich</label></li> <li class="mc-option"><label><input type="radio" name="D-10" value="e"> Räumlich</label></li> </ul>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">11. Was bedeutet «goldene Dekade» für den genannten Zeitraum?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 11 - Niveau 4_2.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <p class="text-gray-700 mb-2">Markiere <strong>zwei</strong> zutreffende Aussagen:</p>
                    <ul> <li class="mc-option"><label><input type="checkbox" name="D-11[]" value="a"> «Einmalige Aussichten»</label></li> <li class="mc-option"><label><input type="checkbox" name="D-11[]" value="b"> «Überdurchschnittliches Wachstum»</label></li> <li class="mc-option"><label><input type="checkbox" name="D-11[]" value="c"> «Aussergewöhnliche Entwicklung»</label></li> <li class="mc-option"><label><input type="checkbox" name="D-11[]" value="d"> «Vernachlässigbares Risiko»</label></li> <li class="mc-option"><label><input type="checkbox" name="D-11[]" value="e"> «Spürbare Veränderung»</label></li> </ul>
                </div>
                <div class="question-container">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">12. Wer spricht?</h3>
                    <div class="mb-4"> <audio controls class="w-full"> <source src="assets/Hören Aufgabe 12 - Niveau 4_3.mp3" type="audio/mpeg"> Dein Browser unterstützt das Audio-Element nicht. </audio> </div>
                    <ul> <li class="mc-option"><label><input type="radio" name="D-12" value="a"> Anlageberater einer Bank in einem Kundengespräch.</label></li> <li class="mc-option"><label><input type="radio" name="D-12" value="b"> Wirtschaftsprofessor an einer Vorlesung in der Universität.</label></li> <li class="mc-option"><label><input type="radio" name="D-12" value="c"> Pressesprecher einer Investmentbank bei der Präsentation der Quartalsergebnisse.</label></li> <li class="mc-option"><label><input type="radio" name="D-12" value="d"> Börsenexperte in einem Fernsehinterview.</label></li> </ul>
                </div>
            </section>

            <section id="section-14" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Teil E: Schreiben</h2>
                <div class="question-container"> <label for="E-01" class="block mb-4 font-medium">Schreibaufgabe:</label>
                    <p class="text-gray-600 mb-4">Beschreiben Sie kurz Ihre letzte Reise. Achten Sie auf korrekte Grammatik und Rechtschreibung. (Empfehlung: 80–100 Wörter)</p>
                    <textarea id="E-01" name="E-01" rows="6" class="text-answer-input" placeholder="Beginnen Sie hier mit Ihrem Text..." spellcheck="false"></textarea>
                    <div class="text-right text-sm text-gray-500 mt-1">Wörter: <span id="word-count-E-01">0</span></div>
                    <p id="word-limit-info" class="text-right text-sm text-orange-600 mt-1" style="display: none;">Empfohlene Wortanzahl (100) überschritten.</p>
                </div>
            </section>

            <section id="section-15" class="test-section">
                <h2 class="text-xl font-semibold text-gray-700 border-t border-gray-200 pt-6 mt-6 mb-6">Test beendet</h2>
                <p class="mb-4 text-gray-600">Vielen Dank für die Teilnahme.</p>
                <p class="mb-6 text-lg font-medium text-blue-700">Bitte informieren Sie nun Ihre Lehrperson, dass Sie den Test abgeschlossen haben.</p>
                <div id="export-section" class="mt-8">
                    <p class="mb-4 text-sm text-gray-500">(Nur für Lehrperson)</p>
                    <button id="export-results-btn" class="bg-purple-500 hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition duration-150 ease-in-out">Ergebnisse exportieren</button>
                    <div id="export-confirmation" class="mt-4 text-green-600 font-medium" style="display: none;">Ergebnisse wurden gespeichert.</div>
                </div>
            </section>
        </div>

        <div id="pause-overlay" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50" style="display: none;">
            <div class="bg-white p-8 rounded-lg shadow-xl text-center max-w-md">
                <h3 class="text-2xl font-bold mb-4 text-gray-700">Pausiert</h3>
                <p class="text-gray-600 mb-4">
                    Ihr aktueller Fortschritt wurde soeben automatisch im gewählten Ordner gespeichert.
                </p>
                <p class="text-gray-600 mb-6">
                    Sie können den Browser nun sicher schliessen, um den Test später fortzusetzen.<br>
                </p>
                <p class="text-gray-600 mb-6">
                    Oder klicken Sie auf "Fortsetzen", um direkt weiterzumachen.
                </p>
                <button id="resume-btn-overlay" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg">
                    Fortsetzen
                </button>
            </div>
        </div>

        <div id="navigation" style="display: none;" class="mt-8 pt-4 border-t flex justify-between items-center">
            <div class="flex gap-2">
                <button id="pause-btn" class="bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition duration-150 ease-in-out">Pausieren</button>
            </div>
            <div>
                <button id="prev-btn" class="bg-gray-500 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition duration-150 ease-in-out mr-2" disabled>Zurück</button>
                <button id="next-btn" class="bg-indigo-500 hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition duration-150 ease-in-out" disabled>Weiter</button>
            </div>
        </div>
    </div>
<script>
    // --- Globale Variable für Ordnerzugriff ---
    let saveDirectoryHandle = null;

    // --- Konfiguration ---
    const config = {
        TOTAL_TEST_SECTIONS: 14,
        LAST_TEST_PAGE_INDEX: 14,
        FINISH_PAGE_INDEX: 15,
        SAVE_FILE_VERSION: "DeutschTestProgress_v4.1_Merged",
        FONT_SIZE_STORAGE_KEY: 'germanTestFontSizeMultiplier_v2_opt_fs',
        FONT_SIZE_STEP: 0.1, MIN_FONT_SIZE_MULTIPLIER: 0.7, MAX_FONT_SIZE_MULTIPLIER: 1.5,
        EXPORT_VERSION: "DeutschTest_V4.1_Export",
        EXPORT_FILENAME_BASE: "Ergebnisse_Deutsch_",
        AUTO_FILE_NAME: "autosave_deutsch.json"
    };

    // --- Globaler Zustand ---
    let testState = {
        currentPage: 0, answers: {}, studentName: '', sectionTimes: {}, isPaused: false,
        totalActiveTimeSeconds: 0, currentSessionStartTime: null, testStartTime: null, testEndTime: null
    };
    let testStarted = false;
    let currentSectionEntryTime = null;

    // --- DOM Elemente Cache ---
    const sections = document.querySelectorAll('.test-section');
    const progressIndicator = document.getElementById('progress-indicator');
    const progressBar = document.getElementById('progress-bar');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const pauseOverlay = document.getElementById('pause-overlay');
    const resumeBtnOverlay = document.getElementById('resume-btn-overlay');
    const startBtn = document.getElementById('start-test-btn');
    const exportBtn = document.getElementById('export-results-btn');
    const navigationDiv = document.getElementById('navigation');
    const exportConfirmation = document.getElementById('export-confirmation');
    const studentNameInput = document.getElementById('student-name');
    const nameError = document.getElementById('name-error');
    const increaseFontBtn = document.getElementById('increase-font-btn');
    const decreaseFontBtn = document.getElementById('decrease-font-btn');
    const selectDirBtn = document.getElementById('select-dir-btn');
    const dirStatus = document.getElementById('dir-status');
    const dirCheck = document.getElementById('dir-check');
    const testContainer = document.getElementById('test-container');
    const textareaE01 = document.getElementById('E-01');
    const wordCountDisplay = document.getElementById('word-count-E-01');
    const wordLimitInfo = document.getElementById('word-limit-info');
    const textareaLesenA = document.getElementById('lesen_vertrauen_05-a');
    const textareaLesenB = document.getElementById('lesen_vertrauen_05-b');

    // --- Hilfsfunktionen ---
    function formatTime(ms) { if (typeof ms !== 'number' || ms < 0) return '0:00:00'; let totalSeconds = Math.floor(ms / 1000); let hours = Math.floor(totalSeconds / 3600); let minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0'); let seconds = (totalSeconds % 60).toString().padStart(2, '0'); return `${hours}:${minutes}:${seconds}`; }
    function generateFilename(base, name, extension) { const date = new Date(); const day = date.getDate().toString().padStart(2, '0'); const year = date.getFullYear(); const monthNames = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember']; const monthName = monthNames[date.getMonth()]; const dateString = `${day}_${monthName}_${year}`; const safeName = (name || "Unbekannt").replace(/[^a-z0-9]/gi, '_').toLowerCase(); return `${base}${safeName}_${dateString}.${extension}`; }
    function setFontSize(multiplier) { multiplier = Math.max(config.MIN_FONT_SIZE_MULTIPLIER, Math.min(config.MAX_FONT_SIZE_MULTIPLIER, multiplier)); document.documentElement.style.setProperty('--base-font-size', `${multiplier}rem`); try { localStorage.setItem(config.FONT_SIZE_STORAGE_KEY, multiplier); } catch (e) { console.warn("Schriftgrössen-Einstellung speichern fehlgeschlagen."); } }
    function changeFontSize(increase) { const currentMultiplier = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--base-font-size').replace('rem', '')) || 1.0; const newMultiplier = increase ? currentMultiplier + config.FONT_SIZE_STEP : currentMultiplier - config.FONT_SIZE_STEP; setFontSize(newMultiplier); }
    function loadFontSize() { let multiplier = 1.0; try { const savedMultiplier = localStorage.getItem(config.FONT_SIZE_STORAGE_KEY); if (savedMultiplier) { const parsedMultiplier = parseFloat(savedMultiplier); if (!isNaN(parsedMultiplier) && parsedMultiplier >= config.MIN_FONT_SIZE_MULTIPLIER && parsedMultiplier <= config.MAX_FONT_SIZE_MULTIPLIER) { multiplier = parsedMultiplier; } else { localStorage.removeItem(config.FONT_SIZE_STORAGE_KEY); } } } catch(e) { console.warn("Schriftgröße laden fehlgeschlagen.", e); } document.documentElement.style.setProperty('--base-font-size', `${multiplier}rem`); }
    function setVisualPausedState(paused) { if (!pauseBtn || !pauseOverlay) return; if (paused) { pauseBtn.textContent = 'Fortsetzen'; pauseBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600'); pauseBtn.classList.add('bg-green-500', 'hover:bg-green-600'); pauseOverlay.style.display = 'flex'; } else { pauseBtn.textContent = 'Pausieren'; pauseBtn.classList.remove('bg-green-500', 'hover:bg-green-600'); pauseBtn.classList.add('bg-blue-500', 'hover:bg-blue-600'); setTimeout(() => { if (!testState.isPaused && pauseOverlay) pauseOverlay.style.display = 'none'; }, 300); } }
    function updateName(name) { testState.studentName = name.trim(); if(nameError) { nameError.style.display = testState.studentName ? 'none' : 'block'; } }
    function updateProgressBar() { const firstTestPage = 1; const lastTestPage = config.LAST_TEST_PAGE_INDEX; const totalTestPages = lastTestPage - firstTestPage + 1; let progress = 0; if (testState.currentPage >= firstTestPage && testState.currentPage <= lastTestPage) { progress = ((testState.currentPage - firstTestPage + 1) / totalTestPages) * 100; } else if (testState.currentPage > lastTestPage) { progress = 100; } if (progressBar) { setTimeout(() => { progressBar.style.width = `${Math.min(100, progress)}%`; }, 0); } }
    function updateWordCount() { if (textareaE01 && wordCountDisplay && wordLimitInfo) { const text = textareaE01.value.trim(); const words = text === '' ? 0 : text.split(/\s+/).filter(Boolean).length; wordCountDisplay.textContent = words; wordLimitInfo.style.display = (words > 100) ? 'block' : 'none'; } else if (wordCountDisplay) { wordCountDisplay.textContent = '0'; if(wordLimitInfo) wordLimitInfo.style.display = 'none'; } }
    function resizeGapInput() { const size = Math.max(3, this.value.length + 1); this.style.minWidth = `${size}ch`; }
    
    // --- Zeitmessung ---
    function stopTimers(timestamp) { if (!testState.isPaused && testState.currentSessionStartTime !== null) { const sessionDuration = timestamp - testState.currentSessionStartTime; testState.totalActiveTimeSeconds = (testState.totalActiveTimeSeconds || 0) + sessionDuration; if (currentSectionEntryTime !== null && testState.currentPage >= 1 && testState.currentPage <= config.LAST_TEST_PAGE_INDEX) { const sectionDuration = timestamp - currentSectionEntryTime; testState.sectionTimes[testState.currentPage] = (testState.sectionTimes[testState.currentPage] || 0) + sectionDuration; } } testState.currentSessionStartTime = null; currentSectionEntryTime = null; }
    function startTimers(timestamp) { if (!testState.isPaused && testStarted && (testState.currentPage >= 1 && testState.currentPage <= config.LAST_TEST_PAGE_INDEX)) { testState.currentSessionStartTime = timestamp; currentSectionEntryTime = timestamp; } else { testState.currentSessionStartTime = null; currentSectionEntryTime = null; } }

    // --- Antwort-Erfassung ---
    function captureCurrentPageAnswers() {
        const currentSection = document.querySelector('.test-section.active');
        if (!currentSection) return;
        if (!testState.answers) { testState.answers = {}; }

        const inputs = currentSection.querySelectorAll('input, select, textarea');
        const checkboxGroupsOnPage = new Set();
        
        currentSection.querySelectorAll('input[type="checkbox"]').forEach(cb => {
            const groupName = (cb.id || cb.name)?.replace('[]', '');
            if (groupName) checkboxGroupsOnPage.add(groupName);
        });

        inputs.forEach(input => {
            const name = input.name;
            const id = input.id;
            let key = id || name?.replace('[]', '');
            if (!key || key === 'student-name') return;

            if (input.type === 'radio') {
                if (input.checked) {
                    testState.answers[key] = input.value;
                }
            } else if (input.type === 'checkbox') {
                 const groupName = key.endsWith('[]') ? key.slice(0, -2) : key;
                 if (checkboxGroupsOnPage.has(groupName)) {
                     const checkedBoxes = Array.from(currentSection.querySelectorAll(`input[name="${input.name}"]:checked`)).map(cb => cb.value);
                     testState.answers[groupName] = checkedBoxes.sort();
                 }
            } else {
                testState.answers[key] = input.value;
            }
        });
    }

    async function autoSaveProgress() {
        if (!saveDirectoryHandle || !testStarted || testState.isPaused) return;
        captureCurrentPageAnswers();
        const stateToSave = { ...testState, saveVersion: config.SAVE_FILE_VERSION };
        const success = await writeToFile(config.AUTO_FILE_NAME, JSON.stringify(stateToSave));
        if (!success) {
            alert("WARNUNG: Automatisches Speichern fehlgeschlagen! Ihr Fortschritt auf dieser Seite wurde möglicherweise nicht gesichert. Prüfen Sie den Status des Speicherordners oder wählen Sie ihn erneut aus.");
        }
    }

    // --- Testablauf & Navigation ---
    function showSection(page) {
        const stopTime = Date.now();
        stopTimers(stopTime);

        sections.forEach((section, i) => section.classList.toggle('active', i === page));
        testState.currentPage = page;

        updateProgressBar();
        updateNavigation();
        updateProgressIndicator();
        restoreAnswers(); 
        window.scrollTo(0, 0);

        const startTime = Date.now();
        startTimers(startTime);
    }
    
    async function nextSection() {
        if (testState.isPaused) resumeTest();
        await autoSaveProgress();
        if (testState.currentPage < config.LAST_TEST_PAGE_INDEX) {
            showSection(testState.currentPage + 1);
        } else if (testState.currentPage === config.LAST_TEST_PAGE_INDEX) {
            testState.testEndTime = Date.now();
            await autoSaveProgress(); 
            showSection(config.FINISH_PAGE_INDEX);
        }
    }

    async function prevSection() {
        if (testState.isPaused) resumeTest();
        await autoSaveProgress();
        if (testState.currentPage > 1) {
            showSection(testState.currentPage - 1);
        }
    }

    async function pauseTest() {
        if (!testStarted || testState.isPaused || testState.currentPage === 0 || testState.currentPage >= config.FINISH_PAGE_INDEX) return;
        stopTimers(Date.now());
        await autoSaveProgress(); 
        testState.isPaused = true;
        setVisualPausedState(true);
        console.log("Test pausiert.");
    }
    
    function resumeTest() { 
        if (!testStarted || !testState.isPaused) return;
        testState.isPaused = false;
        startTimers(Date.now());
        setVisualPausedState(false);
        console.log("Test fortgesetzt.");
    }

    function updateNavigation() {
        if (!prevBtn || !nextBtn || !navigationDiv) return;
        const isTestPage = testState.currentPage > 0 && testState.currentPage < config.FINISH_PAGE_INDEX;
        navigationDiv.style.display = isTestPage ? 'flex' : 'none';
        
        if(isTestPage) {
            prevBtn.disabled = testState.currentPage <= 1;
            nextBtn.disabled = false;
            nextBtn.textContent = (testState.currentPage === config.LAST_TEST_PAGE_INDEX) ? 'Abschliessen' : 'Weiter';
        }

        if(testState.currentPage === config.FINISH_PAGE_INDEX) {
            prevBtn.disabled = false;
            nextBtn.style.display = 'none';
        } else {
             nextBtn.style.display = 'inline-block';
        }
    }

    function updateProgressIndicator() {
        if (!progressIndicator) return;
        const page = testState.currentPage;
        const sectionNames = [
            'Teil A: Sprache im Fokus', 'Teil B: Orthografie – Block 1', 'Teil B: Orthografie – Block 2', 
            'Teil B: Orthografie – Block 3', 'Teil B: Orthografie – Block 4', 'Teil C: Lesen – Aufgabe 1', 
            'Teil C: Lesen – Aufgabe 2', 'Teil C: Lesen – Aufgabe 3', 'Teil C: Lesen – Aufgabe 4', 
            'Teil C: Lesen – Aufgabe 5', 'Teil D: Hören – Teil 1', 'Teil D: Hören – Teil 2', 
            'Teil D: Hören – Teil 3', 'Teil E: Schreiben'
        ];

        if (page === 0) {
            progressIndicator.textContent = 'Startseite';
        } else if (page >= 1 && page <= config.LAST_TEST_PAGE_INDEX) {
            progressIndicator.textContent = `${sectionNames[page - 1] || ''} (Seite ${page} von ${config.LAST_TEST_PAGE_INDEX})`;
        } else if (page === config.FINISH_PAGE_INDEX) {
            progressIndicator.textContent = 'Test abgeschlossen';
        }
    }

    // --- Zustand Wiederherstellen ---
    function restoreAnswers() {
        if (studentNameInput && testState.studentName !== undefined) studentNameInput.value = testState.studentName;
        const currentSection = document.querySelector('.test-section.active');
        if(!currentSection) return;

        currentSection.querySelectorAll('input, select, textarea').forEach(el => {
            if (el.type === 'radio' || el.type === 'checkbox') el.checked = false;
            else if (el.id !== 'student-name') el.value = '';
        });

        if (!testState.answers) testState.answers = {};

        Object.keys(testState.answers).forEach(key => {
            const value = testState.answers[key];
            const elementsByName = currentSection.querySelectorAll(`[name="${key}"], [name="${key+'[]'}"]`);
            const elementById = currentSection.querySelector(`#${CSS.escape(key)}`);

            if (elementsByName.length > 0 && (elementsByName[0].type === 'radio' || elementsByName[0].type === 'checkbox')) {
                if (elementsByName[0].type === 'radio') {
                    elementsByName.forEach(radio => radio.checked = (radio.value === value));
                } else { // Checkbox
                    elementsByName.forEach(cb => cb.checked = Array.isArray(value) && value.includes(cb.value));
                }
            } else if (elementById) {
                elementById.value = value || '';
                if(elementById.classList.contains('gap-input')) resizeGapInput.call(elementById);
                if(elementById.id === 'E-01') updateWordCount();
            }
        });
    }

    // --- Dateiverwaltung & Zustandsladen ---
    async function selectSaveDirectory() {
        if (!window.showDirectoryPicker) {
            alert("Ihr Browser unterstützt die Ordnerauswahl nicht. Bitte verwenden Sie Chrome oder Edge.");
            dirStatus.textContent = 'Fehler: Browser nicht unterstützt.';
            return;
        }

        try {
            saveDirectoryHandle = await window.showDirectoryPicker({ id: 'germanTestSaveFolder', mode: 'readwrite', startIn: 'downloads' });
            
            const permissionStatus = await saveDirectoryHandle.queryPermission({ mode: 'readwrite' });
            if (permissionStatus !== 'granted') {
                const newPermissionStatus = await saveDirectoryHandle.requestPermission({ mode: 'readwrite' });
                if (newPermissionStatus !== 'granted') throw new Error('Keine Ordnerberechtigung erteilt.');
            }

            dirStatus.textContent = `Ordner '${saveDirectoryHandle.name}' bereit. Prüfe Zwischenstand...`;
            dirCheck.classList.remove('hidden');

            const loaded = await loadProgressFromFileSystem();
            if (!loaded) {
                dirStatus.textContent = `Ordner '${saveDirectoryHandle.name}' bereit.`;
            } else {
                dirStatus.textContent = `Ordner '${saveDirectoryHandle.name}' bereit (Zwischenstand geladen).`;
                updateName(studentNameInput.value);
            }

            if (studentNameInput.value.trim()) {
                startBtn.disabled = false;
            }

        } catch (err) {
            console.error("Ordnerauswahl Fehler:", err);
            if (err.name === 'AbortError') {
                dirStatus.textContent = 'Ordnerauswahl abgebrochen.';
            } else {
                dirStatus.textContent = `Fehler Ordnerzugriff: ${err.message}`;
            }
            saveDirectoryHandle = null;
            dirCheck.classList.add('hidden');
            startBtn.disabled = true;
        }
    }

    async function writeToFile(filename, content) {
        if (!saveDirectoryHandle) { console.error("Kein Speicherordner."); return false; }
        try {
            if (await saveDirectoryHandle.queryPermission({ mode: 'readwrite' }) !== 'granted') {
                if (await saveDirectoryHandle.requestPermission({ mode: 'readwrite' }) !== 'granted') throw new Error('Berechtigung verloren.');
            }
            const fileHandle = await saveDirectoryHandle.getFileHandle(filename, { create: true });
            const writable = await fileHandle.createWritable();
            await writable.write(content);
            await writable.close();
            return true;
        } catch (err) {
            console.error(`Fehler Schreiben ${filename}:`, err);
            dirStatus.textContent = `Fehler Speichern! (${err.name})`;
            return false;
        }
    }

    async function loadProgressFromFileSystem() {
        if (!saveDirectoryHandle) return false;
        try {
            const fileHandle = await saveDirectoryHandle.getFileHandle(config.AUTO_FILE_NAME);
            const file = await fileHandle.getFile();
            const loadedState = JSON.parse(await file.text());

            if (loadedState && typeof loadedState.currentPage === 'number') {
                if (confirm(`Zwischenstand gefunden (Name: ${loadedState.studentName || '?'}). Fortsetzen?`)) {
                    return loadState(loadedState);
                }
            }
            return false;
        } catch (err) {
            if (err.name !== 'NotFoundError') console.error(`Fehler Lesen ${config.AUTO_FILE_NAME}:`, err);
            return false;
        }
    }

    function loadState(stateToLoad) {
        Object.assign(testState, stateToLoad);
        testState.isPaused = false; 
        testState.currentSessionStartTime = null;
        currentSectionEntryTime = null;
        testStarted = true;
        
        loadFontSize();
        showSection(testState.currentPage);
        
        startBtn.disabled = true; 
        return true;
    }
    
    // --- EXPORT FUNKTION ---
    async function exportResults() {
        if (testState.isPaused) resumeTest();
        if (!testState.testEndTime) testState.testEndTime = Date.now();
        stopTimers(testState.testEndTime);
        
        // Final capture of all answers before exporting
        const allInputs = testContainer.querySelectorAll('input, select, textarea');
        allInputs.forEach(input => {
            const name = input.name;
            const id = input.id;
            let key = id || name?.replace('[]', '');
            if (!key || key === 'student-name') return;
            if (input.type === 'radio') { if (input.checked) testState.answers[key] = input.value; } 
            else if (input.type === 'checkbox') {
                const groupName = key.endsWith('[]') ? key.slice(0, -2) : key;
                if (!Array.isArray(testState.answers[groupName])) testState.answers[groupName] = [];
                const valueIndex = testState.answers[groupName].indexOf(input.value);
                if (input.checked && valueIndex === -1) testState.answers[groupName].push(input.value);
                else if (!input.checked && valueIndex > -1) testState.answers[groupName].splice(valueIndex, 1);
            } else {
                 testState.answers[key] = input.value;
            }
        });
        Object.keys(testState.answers).forEach(key => {
            if(Array.isArray(testState.answers[key])) testState.answers[key].sort();
        });


        if (!testState.studentName) { alert("Bitte geben Sie einen Namen ein."); studentNameInput?.focus(); return; }
        if (!saveDirectoryHandle) { alert("Bitte wählen Sie zuerst einen Speicherordner."); selectDirBtn?.focus(); return; }

        console.log("Starte Export...");
        
        const exportData = {
             testId: config.EXPORT_VERSION,
             studentName: testState.studentName,
             completionTimestamp: new Date(testState.testEndTime).toISOString(),
             testStartTime: testState.testStartTime ? new Date(testState.testStartTime).toISOString() : null,
             totalActiveTime: formatTime(testState.totalActiveTimeSeconds),
             answers: testState.answers,
             sectionTimesFormatted: Object.keys(testState.sectionTimes).reduce((acc, key) => {
                 acc[`Seite ${key}`] = formatTime(testState.sectionTimes[key]);
                 return acc;
             }, {})
        };

        const resultsString = JSON.stringify(exportData, null, 2);
        const finalResultsFilename = generateFilename(config.EXPORT_FILENAME_BASE, testState.studentName, 'json');

        const success = await writeToFile(finalResultsFilename, resultsString);
        if (success) {
            exportConfirmation.textContent = `Ergebnisse für ${testState.studentName} wurden in '${saveDirectoryHandle.name}/${finalResultsFilename}' gespeichert.`;
            exportConfirmation.style.display = 'block';
            exportConfirmation.classList.remove('text-red-600');
            exportConfirmation.classList.add('text-green-600');
            try {
                await saveDirectoryHandle.removeEntry(config.AUTO_FILE_NAME);
                console.log("Autosave-Datei nach Export gelöscht.");
            } catch (e) {
                if (e.name !== 'NotFoundError') console.warn("Konnte Autosave-Datei nicht löschen:", e);
            }
        } else {
            exportConfirmation.textContent = `Fehler beim Speichern der Ergebnisse.`;
            exportConfirmation.style.display = 'block';
            exportConfirmation.classList.add('text-red-600');
        }
    }

    // --- INITIALISIERUNG & EVENT LISTENER ---
    function initializeTest() {
        showSection(0);
        loadFontSize();
        updateWordCount();

        selectDirBtn?.addEventListener('click', selectSaveDirectory);
        increaseFontBtn?.addEventListener('click', () => changeFontSize(true));
        decreaseFontBtn?.addEventListener('click', () => changeFontSize(false));

        startBtn?.addEventListener('click', () => {
            if (!saveDirectoryHandle) { alert("Bitte zuerst einen Ordner wählen."); return; }
            const studentName = studentNameInput.value.trim();
            if (!studentName) { alert("Bitte zuerst Ihren Namen eingeben."); nameError.style.display = 'block'; studentNameInput.focus(); return; }
            
            updateName(studentName);
            testStarted = true;
            if (!testState.testStartTime) testState.testStartTime = Date.now();
            showSection(1);
        });
        
        studentNameInput?.addEventListener('input', (e) => {
            const name = e.target.value.trim();
            updateName(name);
            startBtn.disabled = !name || !saveDirectoryHandle;
        });

        nextBtn?.addEventListener('click', nextSection);
        prevBtn?.addEventListener('click', prevSection);
        exportBtn?.addEventListener('click', exportResults);

        pauseBtn?.addEventListener('click', async () => {
            if (testState.isPaused) resumeTest();
            else await pauseTest();
        });
        resumeBtnOverlay?.addEventListener('click', resumeTest);

        testContainer?.addEventListener('change', autoSaveProgress);
        testContainer?.addEventListener('input', (e) => {
            if(e.target.tagName === 'TEXTAREA' || e.target.classList.contains('gap-input')) {
                if(e.target.id === 'E-01') updateWordCount();
                if(e.target.classList.contains('gap-input')) resizeGapInput.call(e.target);
                autoSaveProgress();
            }
        });

        document.querySelectorAll('input.gap-input').forEach(input => {
            input.addEventListener('focus', resizeGapInput);
            resizeGapInput.call(input);
        });
    }

    document.addEventListener('DOMContentLoaded', initializeTest);
</script>
</body>
</html>